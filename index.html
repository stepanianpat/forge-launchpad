<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SEO Title Architect</title>
    <!-- Link to your external CSS file -->
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="main-container">
        <section class="hero-section">
            <h1>AI SEO Title Architect</h1>
            <p>Forge irresistible, click-worthy headlines that dominate search results. Unleash AI to craft your perfect SEO titles in seconds!</p>
        </section>

        <section class="form-card">
            <label for="userInput">Enter your core topic or keywords:</label>
            <input type="text" id="userInput" name="userInput" placeholder="e.g., 'sustainable fashion for Gen Z', 'best coffee brewing methods'">
            
            <button id="submitButton" aria-busy="false">Craft My Titles</button> 
            
            <div id="loadingIndicator" class="hidden" aria-busy="true">Architecting titles... please wait.</div>
        </section>
        
        <section class="results-area">
            <h3>Your Crafted SEO Titles:</h3>
            <div id="results">
            </div>
        </section>
    </div>

    <script>
        const submitButton = document.getElementById('submitButton');
        const userInput = document.getElementById('userInput');
        const resultsDiv = document.getElementById('results');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const apiEndpoint = 'https://forge-launchpad.vercel.app/api/getInsight'; // Ensure this is your correct Vercel URL

        submitButton.addEventListener('click', async () => {
            const query = userInput.value;
            resultsDiv.innerHTML = ''; // Clear previous results, including any placeholder text
            resultsDiv.classList.remove('error'); 
            
            if (!query.trim()) {
                resultsDiv.textContent = 'Please enter your topic or keywords to generate titles.';
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            submitButton.disabled = true;
            submitButton.setAttribute('aria-busy', 'true');

            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query }),
                });

                if (response.ok) {
                    const responseText = await response.text();
                    console.log("Received raw response text:", responseText);

                    try {
                        const data = JSON.parse(responseText);
                        // Process and display titles as a list
                        if (data.message) {
                            const titles = data.message.split('\n').filter(title => title.trim() !== ''); 

                            if (titles.length > 0) {
                                const ul = document.createElement('ul');
                                titles.forEach(titleText => {
                                    const li = document.createElement('li');
                                    li.textContent = titleText.trim();
                                    ul.appendChild(li);
                                });
                                resultsDiv.appendChild(ul);
                            } else {
                                resultsDiv.textContent = "No titles were generated, or the response was empty.";
                            }
                        } else {
                             resultsDiv.textContent = "Received an unexpected response format from the AI.";
                        }

                    } catch (parseError) {
                        console.error("Error parsing JSON:", parseError);
                        console.error("Text that failed to parse was:", responseText);
                        resultsDiv.textContent = "Error: Failed to parse the server's response.";
                        resultsDiv.classList.add('error');
                    }
                } else {
                    let errorMsg = `HTTP Error: ${response.status} ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.error ? `API Error: ${errorData.error}` : errorMsg;
                    } catch (e) {
                        // If error response isn't JSON, use the original HTTP error message
                    }
                    throw new Error(errorMsg);
                }

            } catch (error) {
                console.error('Operation failed:', error);
                resultsDiv.textContent = `Operation failed: ${error.message}`;
                resultsDiv.classList.add('error');
            } finally {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.setAttribute('aria-busy', 'false');
            }
        });
    </script>
</body>
</html>
